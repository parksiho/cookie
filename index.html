<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>딸기 민트초코 쿠키 클릭게임 v2</title>
<style>
:root{
  --bg:#fff7fb;
  --panel:#fff;
  --accent:#ff6f91; 
  --mint:#32c48d;  
  --text:#333;
  --gold:#ffd700;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", sans-serif;
  background: linear-gradient(180deg,#fff7fb 0%, #f7fff7 100%);
  color:var(--text);
  display:flex;
  min-height:100vh;
  align-items:center;
  justify-content:center;
  padding:10px;
}
.wrap{
  width:100%;
  max-width:760px;
  background:var(--panel);
  border-radius:14px;
  box-shadow: 0 8px 30px rgba(0,0,0,0.08);
  overflow:hidden;
  min-height: calc(100vh - 20px);
  display: flex;
  flex-direction: column;
}
header{
  padding:18px 20px;
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:space-between;
  border-bottom:1px solid rgba(0,0,0,0.04);
}
.title{
  display:flex;
  gap:12px;
  align-items:center;
  font-weight:700;
  font-size:18px;
}
.title .logo{
  width:44px;height:44px;border-radius:10px;
  background:linear-gradient(135deg,var(--accent),#ffd1e0);
  display:flex;align-items:center;justify-content:center;font-size:22px;
  box-shadow:0 4px 10px rgba(0,0,0,0.06);
}
.controls{
  display:flex;
  gap:10px;
  align-items:center;
}
.stat{
  font-size:14px;
}
button{
  background:linear-gradient(180deg,#fff,#ffeeff);
  border:1px solid rgba(0,0,0,0.06);
  padding:8px 12px;border-radius:10px;font-weight:600;
  cursor:pointer;
}
.game-area{
  position:relative;
  flex: 1;
  min-height: 300px;
  background:
    radial-gradient(circle at 10% 20%, rgba(255,111,145,0.06), transparent 6%),
    radial-gradient(circle at 90% 80%, rgba(50,196,141,0.04), transparent 8%);
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}
.playground{
  position:relative;
  width:92%;
  height:92%;
  border-radius:12px;
}
.cookie, .mint, .gold{
  position:absolute;
  user-select:none;
  cursor:pointer;
  transform-origin:center;
  transition:transform 120ms ease;
  will-change:transform;
  text-shadow: 0 2px 8px rgba(0,0,0,0.12);
  font-size:46px;
}
.cookie:active, .mint:active, .gold:active{ transform: scale(0.9); }
.cookie.touch-down, .mint.touch-down, .gold.touch-down{ 
  transform: scale(0.85); 
  filter: brightness(1.2);
  transition: all 0.1s ease;
}
.cookie.spawn, .mint.spawn, .gold.spawn{
  animation:pop .25s ease;
}
.mint.spawn{ animation:pop .25s ease, spin 2s linear infinite; font-size:52px; }
.gold.spawn{ animation:pop .25s ease, blink 1.2s infinite alternate; font-size:50px;}
@keyframes pop{ from{transform:scale(0)} to{transform:scale(1)} }
@keyframes spin{ from{transform:rotate(0)} to{transform:rotate(360deg)} }
@keyframes blink{ from{opacity:0.7} to{opacity:1} }

/* 폭죽 이펙트 */
.firework {
  position: absolute;
  pointer-events: none;
  z-index: 1000;
}

.firework-particle {
  position: absolute;
  width: 4px;
  height: 4px;
  border-radius: 50%;
  animation: firework-explode 0.8s ease-out forwards;
}

@keyframes firework-explode {
  0% {
    transform: scale(0);
    opacity: 1;
  }
  50% {
    opacity: 1;
  }
  100% {
    transform: scale(1);
    opacity: 0;
  }
}

.firework-particle:nth-child(1) { background: #ff6f91; animation-delay: 0s; }
.firework-particle:nth-child(2) { background: #32c48d; animation-delay: 0.1s; }
.firework-particle:nth-child(3) { background: #ffd700; animation-delay: 0.2s; }
.firework-particle:nth-child(4) { background: #ff6f91; animation-delay: 0.3s; }
.firework-particle:nth-child(5) { background: #32c48d; animation-delay: 0.4s; }
.firework-particle:nth-child(6) { background: #ffd700; animation-delay: 0.5s; }
.firework-particle:nth-child(7) { background: #ff6f91; animation-delay: 0.6s; }
.firework-particle:nth-child(8) { background: #32c48d; animation-delay: 0.7s; }

.hud{
  position:absolute;
  left:12px;top:12px;
  background:rgba(255,255,255,0.85);
  padding:8px 12px;border-radius:8px;
  box-shadow:0 6px 18px rgba(0,0,0,0.06);
  font-weight:700;
}
.message{
  position:absolute;right:12px;top:12px;
  background:rgba(0,0,0,0.06);
  padding:8px 12px;border-radius:8px;font-weight:600;
}
.footer{
  padding:12px 20px;
  display:flex;gap:12px;align-items:center;justify-content:space-between;
  font-size:13px;color:#555;border-top:1px solid rgba(0,0,0,0.04);
}
.small{font-size:12px;color:#666}
.flash{
  position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
  background:rgba(255,255,255,0.92);
  padding:18px 22px;border-radius:10px;font-weight:800;
  box-shadow:0 12px 40px rgba(0,0,0,0.08);
  display:none;
}
.flash.show{display:block}

/* 반응형 디자인 */
@media (max-width: 768px) {
  body {
    padding: 5px;
  }
  
  .wrap {
    min-height: calc(100vh - 10px);
    border-radius: 10px;
  }
  
  header {
    padding: 12px 15px;
    flex-direction: column;
    gap: 8px;
    align-items: stretch;
  }
  
  .title {
    justify-content: center;
    margin-bottom: 8px;
  }
  
  .title .logo {
    width: 36px;
    height: 36px;
    font-size: 18px;
  }
  
  .title > div {
    font-size: 16px;
  }
  
  .title > div > div:last-child {
    font-size: 11px;
  }
  
  .controls {
    justify-content: space-between;
    flex-wrap: nowrap;
    gap: 6px;
    overflow-x: auto;
  }
  
  .stat {
    font-size: 13px;
    white-space: nowrap;
    flex-shrink: 0;
  }
  
  button {
    padding: 6px 10px;
    font-size: 13px;
  }
  
  .game-area {
    min-height: 250px;
  }
  
  .cookie, .mint, .gold {
    font-size: 36px;
  }
  
  .mint.spawn {
    font-size: 42px;
  }
  
  .gold.spawn {
    font-size: 40px;
  }
  
  .hud {
    font-size: 12px;
    padding: 6px 10px;
  }
  
  .message {
    font-size: 11px;
    padding: 6px 10px;
  }
  
  .footer {
    padding: 10px 15px;
    font-size: 12px;
    flex-direction: column;
    gap: 4px;
    text-align: center;
  }
  
  .flash {
    padding: 12px 16px;
    font-size: 14px;
  }
}

@media (max-width: 480px) {
  .title > div {
    font-size: 14px;
  }
  
  .title > div > div:last-child {
    font-size: 10px;
  }
  
  .controls {
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
    flex-wrap: nowrap;
    overflow-x: auto;
    gap: 4px;
  }
  
  .controls button {
    flex-shrink: 0;
    padding: 4px 8px;
    font-size: 12px;
  }
  
  .stat {
    font-size: 11px;
    white-space: nowrap;
    flex-shrink: 0;
  }
  
  .game-area {
    min-height: 200px;
  }
  
  .cookie, .mint, .gold {
    font-size: 28px;
  }
  
  .mint.spawn {
    font-size: 32px;
  }
  
  .gold.spawn {
    font-size: 30px;
  }
  
  .hud {
    font-size: 11px;
    padding: 4px 8px;
  }
  
  .message {
    font-size: 10px;
    padding: 4px 8px;
  }
  
  .footer {
    font-size: 11px;
  }
}
</style>
</head>
<body>
<div class="wrap">
<header>
  <div class="title">
    <div class="logo">🍪</div>
    <div>
      <div>딸기-민트초코 쿠키 클릭게임 v2</div>
      <div style="font-size:12px;color:#666;margin-top:4px">콤보+보너스 쿠키+효과음+폭죽+더블터치!</div>
    </div>
  </div>
  <div class="controls">
    <div class="stat">점수: <span id="score">0</span></div>
    <div class="stat">시간: <span id="timer">30</span>s</div>
    <div class="stat">최고: <span id="best">0</span></div>
    <button id="soundBtn">🔊</button>
    <button id="startBtn">시작</button>
    <button id="resetBtn">초기화</button>
  </div>
</header>

<div class="game-area">
  <div class="playground" id="playground">
    <div class="hud">목표: 제한시간 내 가능한 많은 쿠키 클릭!</div>
    <div class="message small" id="message">민트초코+5점 / 황금쿠키+10점+3초!</div>
    <div class="flash" id="flash">콤보! +<span id="flashAmount">1</span></div>
  </div>
</div>

<div class="footer">
  <div>설명: 🍪 +1 / 🍫 +5 / ✨황금 +10 +3초 / 콤보점수 ↑ / 더블터치 2배!</div>
  <div class="small">파일로 저장 후 브라우저에서 열어 플레이하세요.</div>
</div>
</div>

<script>
(() => {
const playground = document.getElementById('playground');
const scoreEl = document.getElementById('score');
const timerEl = document.getElementById('timer');
const bestEl = document.getElementById('best');
const startBtn = document.getElementById('startBtn');
const resetBtn = document.getElementById('resetBtn');
const flash = document.getElementById('flash');
const flashAmount = document.getElementById('flashAmount');
const soundBtn = document.getElementById('soundBtn');

let score = 0;
let timeLeft = 30;
let timerId = null;
let cookieInterval = null;
let mintInterval = null;
let goldInterval = null;
let running = false;

let combo = 0;
let lastClickTime = 0;

// 더블 터치 감지를 위한 변수들
let lastClickElement = null;
let lastClickTimestamp = 0;
const DOUBLE_TAP_THRESHOLD = 300; // 300ms 내 더블 터치

const BEST_KEY = 'cookie_click_best_v2';
bestEl.textContent = localStorage.getItem(BEST_KEY) || 0;

// 사운드 시스템
let audioContext = null;
let soundEnabled = true;

function initAudio() {
  if (!audioContext) {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
  }
}

function playClickSound(type = 'normal') {
  if (!soundEnabled) return;
  
  initAudio();
  
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();
  
  oscillator.connect(gainNode);
  gainNode.connect(audioContext.destination);
  
  // 쿠키 타입에 따라 다른 사운드
  switch(type) {
    case 'mint':
      oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
      oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.1);
      break;
    case 'gold':
      oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
      oscillator.frequency.exponentialRampToValueAtTime(1500, audioContext.currentTime + 0.15);
      break;
    default: // normal cookie
      oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
      oscillator.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.08);
  }
  
  oscillator.type = 'sine';
  
  gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
  gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
  
  oscillator.start(audioContext.currentTime);
  oscillator.stop(audioContext.currentTime + 0.2);
}

// 폭죽 이펙트 함수
function createFirework(x, y) {
  const firework = document.createElement('div');
  firework.className = 'firework';
  firework.style.left = x + 'px';
  firework.style.top = y + 'px';
  
  // 8개의 파티클 생성
  for (let i = 0; i < 8; i++) {
    const particle = document.createElement('div');
    particle.className = 'firework-particle';
    
    // 각 파티클을 원형으로 배치
    const angle = (i * 45) * (Math.PI / 180);
    const distance = 30 + Math.random() * 20;
    const particleX = Math.cos(angle) * distance;
    const particleY = Math.sin(angle) * distance;
    
    particle.style.left = particleX + 'px';
    particle.style.top = particleY + 'px';
    
    firework.appendChild(particle);
  }
  
  playground.appendChild(firework);
  
  // 애니메이션 완료 후 제거
  setTimeout(() => {
    if (firework.parentNode) {
      firework.remove();
    }
  }, 1000);
}

function rand(min,max){ return Math.random()*(max-min)+min; }

function spawnCookie(){
  const el = document.createElement('div');
  el.className = 'cookie spawn';
  el.textContent = '🍪';
  placeElementRandom(el);
  
  // 터치 다운과 클릭 이벤트 모두 추가
  el.addEventListener('touchstart', e=>{
    e.preventDefault();
    onCookieClick(e,1);
  });
  el.addEventListener('click', e=>onCookieClick(e,1));
  
  playground.appendChild(el);
  setTimeout(()=>{ if(el.parentNode) el.remove(); }, 1800);
}

function spawnMint(){
  if(Math.random()<0.28){
    const el = document.createElement('div');
    el.className = 'mint spawn';
    el.textContent = '🍫';
    placeElementRandom(el);
    
    // 터치 다운과 클릭 이벤트 모두 추가
    el.addEventListener('touchstart', e=>{
      e.preventDefault();
      onCookieClick(e,5);
    });
    el.addEventListener('click', e=>onCookieClick(e,5));
    
    playground.appendChild(el);
    setTimeout(()=>{ if(el.parentNode) el.remove(); }, 2500);
  }
}

function spawnGold(){
  if(Math.random()<0.08){
    const el = document.createElement('div');
    el.className = 'gold spawn';
    el.textContent = '✨';
    placeElementRandom(el);
    
    // 터치 다운과 클릭 이벤트 모두 추가
    el.addEventListener('touchstart', e=>{
      e.preventDefault();
      onGoldClick(e);
    });
    el.addEventListener('click', e=>onGoldClick(e));
    
    playground.appendChild(el);
    setTimeout(()=>{ if(el.parentNode) el.remove(); }, 3500);
  }
}

function placeElementRandom(el){
  const pad = 12;
  const area = playground.getBoundingClientRect();
  
  // 화면 크기에 따라 쿠키 크기 조정
  const isMobile = window.innerWidth <= 768;
  const isSmallMobile = window.innerWidth <= 480;
  
  let baseSize;
  if (isSmallMobile) {
    baseSize = Math.min(60, area.width * 0.15);
  } else if (isMobile) {
    baseSize = Math.min(70, area.width * 0.16);
  } else {
    baseSize = Math.min(80, area.width * 0.18);
  }
  
  const w = baseSize;
  const h = baseSize;
  const x = rand(pad, area.width - w - pad);
  const y = rand(pad + 30, area.height - h - pad);
  el.style.left = x + 'px';
  el.style.top = y + 'px';
}

function onCookieClick(e,pts){
  if(!running) return;
  
  const now = Date.now();
  const currentElement = e.currentTarget;
  
  // 더블 터치 감지
  let isDoubleTap = false;
  if (lastClickElement === currentElement && 
      now - lastClickTimestamp < DOUBLE_TAP_THRESHOLD) {
    isDoubleTap = true;
  }
  
  // 콤보 계산
  combo = (now - lastClickTime < 1000) ? combo+1 : 0;
  lastClickTime = now;
  
  // 점수 계산 (더블 터치 시 2배)
  let basePts = pts + Math.floor(combo/3);
  let totalPts = isDoubleTap ? basePts * 2 : basePts;
  
  score += totalPts;
  
  // 폭죽 이펙트 생성
  const rect = currentElement.getBoundingClientRect();
  const playgroundRect = playground.getBoundingClientRect();
  const fireworkX = rect.left - playgroundRect.left + rect.width / 2;
  const fireworkY = rect.top - playgroundRect.top + rect.height / 2;
  createFirework(fireworkX, fireworkY);
  
  // 점수 표시 (더블 터치 시 특별 표시)
  if (isDoubleTap) {
    flashAmount.textContent = totalPts + ' (더블!)';
  } else {
    flashAmount.textContent = totalPts;
  }
  flashScore(totalPts);
  updateScore();
  
  // 쿠키 타입에 따른 사운드 재생
  if(pts === 5) {
    playClickSound('mint'); // 민트초코 쿠키
  } else {
    playClickSound('normal'); // 일반 쿠키
  }
  
  // 더블 터치 정보 업데이트
  lastClickElement = currentElement;
  lastClickTimestamp = now;
  
  e.currentTarget.remove();
}

function onGoldClick(e){
  if(!running) return;
  
  const now = Date.now();
  const currentElement = e.currentTarget;
  
  // 더블 터치 감지
  let isDoubleTap = false;
  if (lastClickElement === currentElement && 
      now - lastClickTimestamp < DOUBLE_TAP_THRESHOLD) {
    isDoubleTap = true;
  }
  
  // 점수 계산 (더블 터치 시 2배)
  let basePts = 10;
  let totalPts = isDoubleTap ? basePts * 2 : basePts;
  
  score += totalPts;
  timeLeft += 3;
  
  // 폭죽 이펙트 생성
  const rect = currentElement.getBoundingClientRect();
  const playgroundRect = playground.getBoundingClientRect();
  const fireworkX = rect.left - playgroundRect.left + rect.width / 2;
  const fireworkY = rect.top - playgroundRect.top + rect.height / 2;
  createFirework(fireworkX, fireworkY);
  
  // 점수 표시 (더블 터치 시 특별 표시)
  if (isDoubleTap) {
    flashAmount.textContent = totalPts + ' (더블!)';
  } else {
    flashAmount.textContent = totalPts;
  }
  flashScore(totalPts);
  updateScore();
  
  // 황금 쿠키 사운드 재생
  playClickSound('gold');
  
  // 더블 터치 정보 업데이트
  lastClickElement = currentElement;
  lastClickTimestamp = now;
  
  e.currentTarget.remove();
}

function flashScore(amount){
  flashAmount.textContent = amount;
  flash.classList.add('show');
  setTimeout(()=> flash.classList.remove('show'), 500);
}

function updateScore(){
  scoreEl.textContent = score;
  const best = Number(localStorage.getItem(BEST_KEY) || 0);
  if(score > best){
    localStorage.setItem(BEST_KEY, score);
    bestEl.textContent = score;
  }
}

function tick(){
  timeLeft -= 1;
  timerEl.textContent = timeLeft;
  if(timeLeft <= 0) endGame();
}

function startGame(){
  if(running) return;
  running = true;
  score = 0;
  timeLeft = 30;
  combo = 0;
  
  // 더블 터치 정보 초기화
  lastClickElement = null;
  lastClickTimestamp = 0;
  
  scoreEl.textContent = score;
  timerEl.textContent = timeLeft;
  startBtn.textContent = '플레이 중...';

  cookieInterval = setInterval(spawnCookie, 650);
  mintInterval = setInterval(spawnMint, 2200);
  goldInterval = setInterval(spawnGold, 5500);
  timerId = setInterval(tick, 1000);
}

function endGame(){
  running = false;
  startBtn.textContent = '시작';
  clearInterval(timerId); timerId = null;
  clearInterval(cookieInterval); cookieInterval = null;
  clearInterval(mintInterval); mintInterval = null;
  clearInterval(goldInterval); goldInterval = null;

  [...playground.querySelectorAll('.cookie, .mint, .gold')].forEach(n=>n.remove());
  const best = Number(localStorage.getItem(BEST_KEY) || 0);
  alert(`시간 종료! 점수: ${score}. 최고점: ${best}.`);
}

function resetBest(){
  localStorage.removeItem(BEST_KEY);
  bestEl.textContent = '0';
}

// 사운드 토글 기능
function toggleSound() {
  soundEnabled = !soundEnabled;
  soundBtn.textContent = soundEnabled ? '🔊' : '🔇';
}

startBtn.addEventListener('click', startGame);
resetBtn.addEventListener('click', ()=>{ if(confirm('기록을 초기화?')) resetBest(); });
soundBtn.addEventListener('click', toggleSound);
window.addEventListener('keydown', (e)=>{ if(e.code==='Space'){ e.preventDefault(); startGame(); } });
})();
</script>
</body>
</html>